## 41: 不正なレビューをブロックせよ！

### お題
レビュー作成（`createReview`）にバリデーションを追加し、不正なデータが登録されないようにしてください。

### 要件
- `rating` が **1〜5** の範囲外であればエラーを返すようにしてください。
- `content` が **空文字または5文字未満** の場合も同様にエラーを返すようにしてください。
- バリデーションエラーは `GraphQLError` を使って、クライアントに理由がわかるようなメッセージで返してください。

### ヒント
- `throw new GraphQLError("エラーメッセージ")` で返せます。
- 複数条件を丁寧に処理して、メッセージを使い分けると親切です。
- クライアント側でバリデーションしていても、サーバー側のチェックは必須です！

## 42: 一人のユーザーは同じ商品に何度もレビューできるのか？

### お題  
一人のユーザーが、同じ商品に複数回レビューできてしまう問題に対応してください。

### 要件
- `createReview` ミューテーションにロジックを追加し、**同じユーザーが同じ商品に2回以上レビューを投稿できない**ようにしてください。
- 二重投稿が試みられた場合は、`GraphQLError` を投げて適切なエラーメッセージを返してください。
- 他のユーザーが同じ商品にレビューするのはOKです。

### ヒント
- `reviews` の中から `productId` と `userId` の両方が一致するデータが存在しないかチェックしましょう。
- エラーメッセージ例：「このユーザーはすでにこの商品にレビューを投稿しています」

## 43: お気に入り商品機能を追加しよう

### お題
ユーザーが商品をお気に入り登録できる機能を追加してください。

### 要件
- 新しい `Favorite` 型を作成し、ユーザーと商品の関連を表現してください
- `User` 型に `favoriteProducts: [Product!]!` フィールドを追加してください
- `Product` 型に `favoritedBy: [User!]!` フィールドを追加してください
- お気に入り登録するための `addFavorite(userId: ID!, productId: ID!): Favorite!` ミューテーションを追加してください
- お気に入り解除するための `removeFavorite(userId: ID!, productId: ID!): Boolean!` ミューテーションを追加してください
- ユーザーのお気に入り商品一覧を取得できるようにしてください

### ヒント
- 中間テーブル的なアプローチで `Favorite` 型を使い、`userId` と `productId` を持たせると良いでしょう
- お気に入り追加時に、すでに登録済みの場合はエラーを返すようにしましょう
- お気に入り解除時に、該当するお気に入りがない場合は `false` を返すようにしましょう

## 44: ユーザーのお気に入り商品件数を取得しよう

### お題
ユーザーごとのお気に入り商品数を取得できるようにしてください。

### 要件
- `User` 型に `favoriteProductCount: Int!` フィールドを追加してください
- `users` クエリの結果に、各ユーザーのお気に入り商品数が含まれるようにしてください
- お気に入り商品がない場合は `0` が返るようにしてください

### ヒント
- 必ずしも専用のカウントフィールドを持つ必要はなく、`favoriteProducts` の長さを返す実装でも構いません
- ユーザーリゾルバに `favoriteProductCount` を実装して計算する形にすると良いでしょう

## 45: ユーザーフォロー機能の基本を実装しよう

### お題
ユーザー同士がフォローできる機能の基本部分を実装してください。

### 要件
- 新しい `Follow` 型を作成し、フォローする側（follower）とフォローされる側（following）の関連を表現してください
- ユーザーをフォローするための `followUser(followerId: ID!, followingId: ID!): Follow!` ミューテーションを追加してください
- `User` 型に `followers: [User!]!` フィールドを追加して、あるユーザーをフォローしているユーザー一覧を取得できるようにしてください
- ユーザー自身をフォローすることはできないよう、バリデーションを追加してください

### ヒント
- `Follow` 型には `id`, `followerId`, `followingId` フィールドを持たせると良いでしょう
- フォロー関係を表現するために、中間テーブル的なアプローチを使いましょう
- フォロー追加時に、同じユーザーの組み合わせが既に存在する場合はエラーを返すようにしましょう
- フォロワー一覧の取得は、`followers` フィールドのリゾルバで実装しましょう

## 46: フォローしているユーザー一覧の取得とカウント機能を追加しよう

### お題
ユーザーがフォローしている人の一覧を取得できるようにし、フォロワー数とフォロー数のカウント機能を追加してください。

### 要件
- `User` 型に `following: [User!]!` フィールドを追加して、ユーザーがフォローしている人の一覧を取得できるようにしてください
- `User` 型に以下のカウントフィールドを追加してください:
  - `followerCount: Int!` - そのユーザーをフォローしている人の数
  - `followingCount: Int!` - そのユーザーがフォローしている人の数
- `users` クエリの結果に、各ユーザーのフォロワー数とフォロー数が含まれるようにしてください

### ヒント
- `following` フィールドのリゾルバでは、`follows` データからそのユーザーがフォローしているユーザーIDを取得し、対応するユーザーオブジェクトを返しましょう
- カウントフィールドは必ずしも専用のデータを持つ必要はなく、リゾルバ内で計算する形でも構いません
- 一貫性のために、フォローしている人もフォロワーも同様にリゾルバで処理すると良いでしょう

## 47: フォロー解除機能を実装しよう

### お題
ユーザーのフォローを解除する機能を実装してください。

### 要件
- 既に実装されている `unfollowUser(userId: ID!, followingId: ID!): Boolean!` ミューテーションを使って、フォロー解除機能を実装してください
- フォロー解除に成功したら `true` を返し、対象のフォロー関係が存在しない場合は `false` を返すようにしてください
- 解除処理の前に、フォロー関係が実際に存在するかどうかを確認してください

### ヒント
- `follows` データから、指定された `userId` と `followingId` の組み合わせが存在するかを確認しましょう
- フォロー関係が存在する場合のみ、そのデータを削除しましょう
- 存在しないフォロー関係を解除しようとした場合はエラーではなく `false` を返すようにしましょう

## 48: ユーザープロフィール情報を拡張しよう

### お題
ユーザープロフィールにより詳細な情報を追加してください。

### 要件
- `User` 型に以下のフィールドを追加してください：
  - `bio: String` - ユーザーの自己紹介文（省略可能）
  - `location: String` - ユーザーの居住地（省略可能）
  - `website: String` - ユーザーのウェブサイトURL（省略可能）
  - `registeredAt: String!` - ユーザー登録日時（必須）
- `updateUserProfile(userId: ID!, bio: String, location: String, website: String): User!` ミューテーションを追加してください
- プロフィール情報を取得するクエリを実装してください

### ヒント
- 省略可能なフィールドには `null` 値が設定可能なように型定義してください
- ミューテーションでは、更新されないフィールドは現在の値を維持するようにしてください
- 日付は ISO 形式の文字列として扱い、既存ユーザーには現在の日時を設定しましょう

## 49: ユーザーの検索機能を実装しよう

### お題
ユーザーを検索できる機能を実装してください。

### 要件
- `searchUsers(query: String!): [User!]!` クエリを追加してください
- 検索条件としては以下のフィールドで部分一致検索ができるようにしてください：
  - ユーザー名（name）
  - 自己紹介（bio）
  - 居住地（location）
- 検索キーワードが空文字の場合は全てのユーザーを返してください
- 検索結果には、ユーザーの基本情報（id, name, email）に加えて、プロフィール情報（bio, location, website, registeredAt）も含めてください

### ヒント
- 検索は大文字・小文字を区別しない（case-insensitive）実装にするとユーザーフレンドリーです
- JavaScriptの`String.prototype.toLowerCase()`と`String.prototype.includes()`を組み合わせて実装するとよいでしょう
- 複数のフィールドで検索する場合は、OR条件（いずれかのフィールドが一致）として実装しましょう
