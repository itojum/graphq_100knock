## #31: 商品レビューの追加

### お題
商品に対してレビューを投稿できるようにしてください。

### 要件
- レビューには、`content`（本文）と`rating`（1〜5の整数）が必要。
- レビューは`Product`に紐づく。
- レビューを作成するMutationを追加すること。
- `Product`を取得したときに、そのレビュー一覧も取得可能にする。

### ヒント
- 新しい型 `Review` を定義して、`Product` 型に `reviews` フィールドを追加する。
- `rating` のバリデーションは次のステップ以降で考慮しても構いません。まずは構造を整えましょう。

## #32: 商品のレビューを取得しよう  
### お題  
特定の商品に紐づくレビュー一覧を取得できるクエリを実装してください。

### 要件  
- Product型に`reviews: [Review!]!`フィールドを追加する  
- クエリで`product(id: ID!)`から、その商品のレビュー一覧がネストして取得できるようにする  

### ヒント  
- Review型の中に`productId`を持たせておき、それでフィルタするようにしましょう  
- Productにネストさせるレビューは、productIdが一致するものだけにしてください  

## #33: 商品を価格で絞り込めるようにしよう
### お題
`products`クエリに、価格範囲で商品を絞り込む機能を追加しよう！

### 要件
- `products`に`minPrice`と`maxPrice`という**オプショナルな引数**を追加する
- `minPrice`以上、`maxPrice`以下の商品だけを返す
- どちらの引数もない場合は、すべての商品を返す

### ヒント
- 両方の引数は**Float型**にする
- `.filter()`を使ってリストを絞り込むとスッキリ書ける
- minだけ、maxだけ指定された場合にも正しく動くように分岐を考えよう！

## #34: 商品レビューにバリデーションを付けよう
### お題
レビュー投稿時に、評価（rating）が1〜5の範囲外だったらエラーにするバリデーションを実装せよ！

### 要件
- `createReview`ミューテーションにバリデーションを追加する
  - `rating`が1未満、または5より大きい場合はエラーを返す
- できればGraphQLエラー（throw new Error）を返す形にする

### ヒント
- `createReview`のリゾルバの中でチェックを挟むだけでOK！
- GraphQLのエラーハンドリングは普通のJavaScript例外で大丈夫！
  ```ts
  if (rating < 1 || rating > 5) {
    throw new Error('評価は1〜5の間で入力してください');
  }
  ```

## #35: 商品に紐づくレビューをフィルタして取得できるようにしよう
### お題
`product(id: ID!)` の中で、レビュー一覧を取得する時に、**レビューの点数(rating)** を条件に絞り込めるようにしてください。

### 要件
- `product` の `reviews` フィールドに、**`minRating`** 引数（オプショナル）を追加する
- `minRating`が指定された場合、その点数以上のレビューのみ返す
- 指定されない場合は全件返す
- 新しいクエリやトップレベルエンドポイントは作らない

### ヒント
- GraphQLの**フィールド引数**は、型定義に追加できます
- リゾルバで、引数が渡ってきた場合だけフィルタ処理をする
- 無理に複雑なロジックにはしないでOK。単純な絞り込みでOK！

## 36本目: 商品レビューのソートを実装しよう
### お題
商品 (`Product`) に紐づくレビュー (`Review`) を、**指定した順序**（例えば評価の高い順 or 低い順）で取得できるようにしよう！

### 要件
- `product` クエリの中で、`reviews` フィールドに**`sortBy`引数**を追加すること
- `sortBy` には `"RATING_ASC"` か `"RATING_DESC"` を渡せるようにする
- ソート順に合わせて、レビューを並び替えて返すこと

### ヒント
- GraphQLでは**引数にEnum型**を使うと、値を制限できてきれいです！
- `sortBy` が指定されない場合は、デフォルトの順番で返してもOKです！


## 37本目: ユーザーとそのレビューをネストで取得しよう  
### お題  
特定のユーザーが書いたレビューと、レビュー対象の商品情報を1つのクエリで取得しよう。

### 要件  
- 既存の `user(id: ID!): User` を利用する  
- `User` 型に `reviews: [Review!]!` を追加する  
- `Review` 型には `product: Product!` を含めること  
- クエリ結果では、ユーザーの名前、各レビューの評価・コメント・対象商品名が含まれていること

### ヒント  
- リゾルバで `Review` をユーザーIDでフィルタしよう  
- `Review` → `Product` へのリレーションは `productId` で解決する形になるはずです

## 38本目: 商品ごとのレビュー件数を取得せよ  
### お題  
全ての商品に対して、それぞれのレビュー件数を取得しよう。

### 要件  
- `products: [Product!]!` クエリを使う  
- `Product` 型に `reviewCount: Int!` フィールドを追加する  
- クエリ結果に商品名とレビュー件数が表示されるようにする

### ヒント  
- `reviewCount` は `Product` のリゾルバでレビュー配列をフィルタして数える  
- フィールドリゾルバで `reviewCount` を解決することで柔軟性が高まります  

## 39本目: 高評価レビューとその投稿者を一覧せよ  
### お題  
評価が高いレビュー（例: rating ≧ 4）を一覧し、そのレビュアーの名前も一緒に表示してください。

### 要件  
- `reviews` クエリに `minRating` 引数を追加する（例: `reviews(minRating: Int): [Review!]!`）  
- 各レビューに `user { name }` を含めて出力する  

### ヒント  
- `Review` 型に `user: User!` を定義し、リゾルバで `userId` をもとに参照  

その通りです！38本目で `reviewCount` を取得する実装をすでに行っていましたね。  
完全に重複しています。失礼しました。

それでは、より発展的で意味のある40本目を改めてご提案します。


## 40本目: 商品の平均評価を取得せよ  
### お題  
各商品ごとに、その商品に紐づくレビューの平均スコア（`rating`）を取得できるようにしてください。

### 要件  
- `Product` 型に `averageRating: Float` を追加する  
- クエリで `products { id name averageRating }` のように取得できること  
- 評価が1件もない場合は `null` を返す仕様にすること（もしくは `0` でも可：実装側で判断）

### ヒント  
- レビューの `rating` を合計し、件数で割るだけ  
- JSの `reduce` 関数で合計を出すときれいに書けます
